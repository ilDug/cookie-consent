name: NodeJS build and test

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:


  # build:
  #   runs-on: ubuntu-latest

  #   strategy:
  #     matrix:
  #       node-version: [14.x, 16.x, 18.x]

  #   name: Node ${{ matrix.node-version }} build

  #   steps:
  #   - uses: actions/checkout@v3

  #   - name: Use Node.js ${{ matrix.node-version }}
  #     uses: actions/setup-node@v3
  #     with:
  #       node-version: ${{ matrix.node-version }}

 
  #   - run: npm ci
  #   - run: npm run build
    

  # cypress-run:
  #   # needs: build
  #   runs-on: ubuntu-latest


  #   name: Cypress Test 
  #   steps:
  #     - name: Checkout
  #       uses: actions/checkout@v3

  #     - name: Setup Node
  #       uses: actions/setup-node@v3
  #       with:
  #         node-version: 14

  #     - name: Install Packages
  #       run: npm ci

  #     - name: Build 
  #       run: npm run build

  #     - name: Cypress run
  #       run: npm run cy:ci



  cypress-2:
  # needs: build
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        # browser: [chrome, edge, firefox]
        browser: [chrome]
    
    name: Cypress Test on  ${{ matrix.browser }} 
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      # Install NPM dependencies, cache them correctly
      # and run all Cypress tests
      - name: Cypress run on  ${{ matrix.browser }} 
        uses: cypress-io/github-action@v4 # use the explicit version number
        with:
          build: npm run build
          start: npm run serve:test
          browser: ${{ matrix.browser }}


  # publish:
  #   runs-on: ubuntu-latest

  #   name: publish to npm
  #   steps:
  #   - uses: actions/checkout@v3
  #   - uses: actions/setup-node@v3
  #     with:
  #       node-version: '14.x'
  #       registry-url: 'https://registry.npmjs.org'
  #   - run: npm ci
  #   - run: npm publish
  #     env:
  #       NODE_AUTH_TOKEN: ${{ secrets.NPM_TOKEN }}
  #   - uses: actions/setup-node@v3
  #     with:
  #       registry-url: 'https://npm.pkg.github.com'
  #   - run: npm publish
  #     env:
  #       NODE_AUTH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

